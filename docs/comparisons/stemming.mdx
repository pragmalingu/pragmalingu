---
id: stemming
title: Simple Search vs. Stemming
author: Samy Ateia and Miriam Rupprecht
date: April 2021
sidebar_label: Stemming
custom_edit_url: null
---

import useBaseUrl from '@docusaurus/useBaseUrl'
import styles from '../doc.css';

## 1. What is Stemming?
Stemming is the process of removing the alternating endings from words. The words **fish**, **fishing**, **fished** would all be recuded to their common word stem **fish**. 
This stem is then stored in the inverted index of the search engine instead of the original word at that position. 
When you search with either of the original words, your query is also stemmed and the search engine can find all documents that contain any of the documents containing words with the same stem.  

There are two common approaches to implement stemming in search engines.  


### Algorithmic Stemming
The [Porter stemming alogrithm](https://snowballstem.org/algorithms/porter/stemmer.html) create by [Martin Porter](https://en.wikipedia.org/wiki/Martin_Porter) is one of the most popular algorithmic stemmers and used by default in the built in [language analyzers](https://www.elastic.co/guide/en/elasticsearch/reference/7.12/analysis-stemmer-tokenfilter.html) in Elasticsearch.
Algorithmic stemmers are very fast and don't need alot of memory, because they only apply a set of rules, that represent the common rules how words are [inflected](https://en.wikipedia.org/wiki/Inflection) in a specific language.  
Because there are always exeptions to a rule, an algorithmic stemmer might produce the same stem for words that have different meanings.
This error is called **overstemming**. 
Another error that can happen is called **understemming** and happens when two inflected words with different endings but the same meaning and stem are not reduced to the same stem.

### Dictionary Based Stemming
The second common approach to stemming is [dictionary based stemming](https://www.elastic.co/guide/en/elasticsearch/reference/current/stemming.html#dictionary-stemmers).
Dictionary stemmers look up words in a dictionary before removing their inflected endings and reducing them to their stem.
Dictionary stemmers should work better on iregular words or words that are similar but have different meanings.
In theory dictionary stemmers should be able to reduce over and understemming and lead to better results that algorithmic stemmers.
In practice they often perform worse that algorithmic stemmers, because the freely available dictionaries are missing important words or are outdated.
Dictionary stemmers also have the draw back that their are slower and require more memory because they have to lookup all words in their dictionary.

### Comparison
In this comparison we are answering the following questions:
- How much does the relevancy of search results improve by using a stemmer?
- How good is the hunspell stemmer include in Elasticsearch performing with a free dictionary?

## 2. Results
The following are the results from our [first Experiment](/docs/experiments/experiment1). You can reproduce these results yourself if you follow the instructions on our [experiment section](/docs/experiments/).

**F1-Score**
<details>
<summary>What is "F1-Score"?</summary>  
The F1-Score measures a harmonic mean between Precision and Recall. Therefore we multiply Precision and Recall by two and divide it by the sum of Precision and Recall: <br />
`F1-Score=(2*Precision*Recall)/(Precision+Recall)`
This is the simplest way to balance both Precision and Recall, there are also other common options to weight them differently.
</details> 
<img alt="F1-Score" src={useBaseUrl('img/EXP1_F1-Score.png')} />
<a class="buttons" href="https://colab.research.google.com/github/pragmalingu/experiments/blob/master/01_Stemming/Experiment/First_Experiment_Stemming.ipynb#scrollTo=Gm1Aej_-T9e0"><button class="buttons" >Run it in Google Colab</button></a>

On all evaluation datasets except NPL, the algorithmic stemmer outperformed the standard analyzer as well as the hunspell token filter.


### Discussion
What are the biggest differences in precision and recall between our approaches and how can we explain them?

Looking at the f1 score fom our approaches we can see that both stemming approaches perform better than the standard baseline on most datasets.
Algorithmic stemming performs better than the standard analyzer on all datasets, it has the biggest gain on the LISA and NPL datasets.
Hunspell stemming performs worse than algorithmic stemming on most datasets except NPL where it performs slighlty better.
Hunspell stemming performs worse than the standard analyzer on the medline dataset.

The are a list of interesting questions that we can ask by just looking at these results:

1.   Why is algorithmic stemming performing better than the standard analyzer?
2.   Why is algorithmic stemming performing better that hunspell stemming?
3.   Why is hunspell stemming performing worse that the standard analyzer on the Medline dataset?
4.   Why is hunspell stemming performing better that the algorithmic stemmer on the NPL dataset?

To break down these results on the individual querys and finnally word matches and to analze under and over stemming that leads to these results, 
we need to first look at the precision and recall scores individually and then extract the false positives and negatives that lead to these results and analyse them.


#### 1. Algorithmic stemming improvements 

Stemmer 
(NPL both improvements)
Why is hunspell stemming performing better on the NPL dataset

##### Example 1:
Query: FAST TRANSISTOR COUNTERS

Text of relevant document: 
'nonsaturating pulse circuits using two junction transistors  
junction transistors are found to be fast enough for pulse applications if the collector voltage is prevented from reaching zero 
switching times can be achieved with available types  
the required limiting action is effected by introducing diodes which terminate the switching transients by their breakdown  
a two transistor binary counter is described'

Stemming Hits: 
'nonsaturating pulse circuits using two junction <em>transistors</em>  junction <em>transistors</em> are found to be <em>fast</em> (...)  a two <em>transistor</em> binary <em>counter</em> is described'
Score: 12.49
Position: 2
```
{
    "score": 12.492224,
    "text": {
        "total_value": 4.3146806,
        "details": [
            {
                "function": {
                    "value": 4.3146806,
                    "description": "weight(text:fast in 8393) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 84,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 4.224553,
                    "description": "weight(text:transistor in 8393) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 640,
                    "freq, occurrences of term within document": 3.0
                }
            },
            {
                "function": {
                    "value": 3.9529896,
                    "description": "weight(text:counter in 8393) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 127,
                    "freq, occurrences of term within document": 1.0
                }
            }
        ]
    }
}
```



Normal Hits: 
'nonsaturating pulse circuits using two junction transistors  junction transistors are found to be <em>fast</em> is effected by introducing diodes which terminate the switching transients by their breakdown  a two <em>transistor</em>'
Score: 7.10
Position: 33
```
{
    "score": 7.102995,
    "text": {
        "total_value": 4.3146806,
        "details": [
            {
                "function": {
                    "value": 4.3146806,
                    "description": "weight(text:fast in 8305) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 84,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 2.7883143,
                    "description": "weight(text:transistor in 8305) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 479,
                    "freq, occurrences of term within document": 1.0
                }
            }
        ]
    }
}
```

##### Example 2:
Query: I WISH TO HAVE DATA ABOUT THE DESIGN OF MECHANICAL BAND PASS FILTERS FOR GOOD PASS CHARACTERISTICS

Text: electromechanical quadripoles as coupling filters  
the equivalent circuits of mechanical resonators and electromechanical transducers are derived and the design of 
band pass filters consisting of input and output electromechanical transducers coupled by a mechanical transmission line is described

Hunspell hits:
'electromechanical quadripoles as coupling <em>filters</em>  <em>the</em> equivalent circuits <em>of</em> <em>mechanical</em> resonators and',
     'electromechanical transducers are derived and <em>the</em> <em>design</em> <em>of</em> <em>band</em> <em>pass</em> <em>filters</em> consisting <em>of</em> input and',
     'output electromechanical transducers coupled by a <em>mechanical</em> transmission line <em>is</em> described'

Score: 27.66
Position: 8
```
{
    "score": 27.663153,
    "text": {
        "total_value": 8.482999,
        "details": [
            {
                "function": {
                    "value": 8.482999,
                    "description": "weight(text:pass in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 211,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 0.7698462,
                    "description": "weight(text:i in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 5540,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.2943766,
                    "description": "weight(text:band in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 515,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 4.6610727,
                    "description": "weight(text:filter in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 442,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 0.27686566,
                    "description": "weight(text:the in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 9422,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 0.19014841,
                    "description": "weight(text:of in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 10165,
                    "freq, occurrences of term within document": 3.0
                }
            },
            {
                "function": {
                    "value": 6.490491,
                    "description": "weight(text:mechanical in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 123,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 3.497353,
                    "description": "weight(Synonym(text:design text:sign) in 9960) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 996,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```
Algorithmic Stemmer hits:
'electromechanical quadripoles as coupling <em>filters</em>  <em>the</em> equivalent circuits <em>of</em> <em>mechanical</em> resonators and',
     'electromechanical transducers are derived and <em>the</em> <em>design</em> <em>of</em> <em>band</em> <em>pass</em> <em>filters</em> consisting <em>of</em> input and',
     'output electromechanical transducers coupled by a <em>mechanical</em> transmission line is described'

Score: 23.35
Position: 24
```
{
    "score": 23.355726,
    "text": {
        "total_value": 7.6372986,
        "details": [
            {
                "function": {
                    "value": 7.6372986,
                    "description": "weight(text:pass in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 290,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 2.5505674,
                    "description": "weight(text:design in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 983,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.2222745,
                    "description": "weight(text:band in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 515,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 4.5917997,
                    "description": "weight(text:filter in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 442,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 0.2727509,
                    "description": "weight(text:the in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 9422,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 0.18800907,
                    "description": "weight(text:of in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 10165,
                    "freq, occurrences of term within document": 3.0
                }
            },
            {
                "function": {
                    "value": 4.8930264,
                    "description": "weight(text:mechan in 9961) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 357,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```


Just looking at the best ranked hunspell hit that is not present in the top 20 of the algorithmic stemmer hits doesn't explain to us why hunspell is performing better in this szenario.
We instead have to look at the disjoint set of false positives between those two stemmers.
The highest ranked document for the algorithmic stemmer is:

Text: design of transistor i  f  amplifier detector stages with stabilized band pass characteristics  an extension of work described earlier
id: 666

Algorithmic stemmer hits:
'<em>design</em> <em>of</em> transistor <em>i</em>  f  amplifier detector stages with stabilized <em>band</em> <em>pass</em> <em>characteristics</em>  an extension',
     '<em>of</em> work described earlier'

Score: 26.72
Position: 4
```
{
    "score": 26.723429,
    "text": {
        "total_value": 9.461221,
        "details": [
            {
                "function": {
                    "value": 9.461221,
                    "description": "weight(text:pass in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 290,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.1596878,
                    "description": "weight(text:design in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 983,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.3837206,
                    "description": "weight(text:characterist in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 826,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 6.536483,
                    "description": "weight(text:i in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 71,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.9918106,
                    "description": "weight(text:band in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 515,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 0.19050553,
                    "description": "weight(text:of in 3776) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 10165,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```
 Hunspell stemmer hits:
 '<em>design</em> <em>of</em> transistor <em>i</em>  f  amplifier detector stages with stabilized <em>band</em> <em>pass</em> <em>characteristics</em>  an extension',
      '<em>of</em> work described earlier'


Score: 23.03
Position: 53
```
{
    "score": 23.034937,
    "text": {
        "total_value": 10.42015,
        "details": [
            {
                "function": {
                    "value": 10.42015,
                    "description": "weight(text:pass in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 211,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 3.431804,
                    "description": "weight(text:characteristic in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 825,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 0.94564575,
                    "description": "weight(text:i in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 5540,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 4.04667,
                    "description": "weight(text:band in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 515,
                    "freq, occurrences of term within document": 1.0
                }
            },
            {
                "function": {
                    "value": 0.19214848,
                    "description": "weight(text:of in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 10165,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 3.9985192,
                    "description": "weight(Synonym(text:design text:sign) in 3775) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 996,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```
#### 2. Algorithmic stemming vs dictionary stemming

Medline 

Query:
the crystalline lens in vertebrates, including humans.

hit id: 508
Text 
"1752. separation of the soluble proteins of bovine lenses on polyacrylamide gels the soluble proteins of bovine lenses were separated by gel
 filtration on polyacryl- amide gels.  the presence of ethylenediaminetetra- acetate in the buffer was found to be essential for achieving a 
 good separation of the lens homogenate into four fractions - a, b, c and d.  ultracentrifugal, electrophoretic and immunochemical analyses were
  used to compare these fractions with the soluble crystallin fractions of the lens.  fraction a was compared with a-crystallin, fractions b and 
  c with b-crystallin and fraction d with y-crystallin. the distribution of these four protein fractions in the nuclear and cortical parts of calf 
  and cow lenses was determined. the oxidation-sensitive protein fraction of the calf lenses was separated from fraction b on an se-sephadex column."

Algorithmic stemmer hits:
'<em>the</em> presence of ethylenediaminetetra- acetate <em>in</em> <em>the</em> buffer was found to be essential for achieving a',
     'good separation of <em>the</em> <em>lens</em> homogenate into four fractions - a, b, c and d.',
     'soluble <em>crystallin</em> fractions of <em>the</em> <em>lens</em>.',
     'fraction a was compared with a-<em>crystallin</em>, fractions b and c with b-<em>crystallin</em> and fraction d with y-<em>crystallin</em>',
     '. <em>the</em> distribution of these four protein fractions <em>in</em> <em>the</em> nuclear and cortical parts of calf and cow'

Score: 11.56
Position: 4

```
{
    "score": 11.56134,
    "text": {
        "total_value": 0.028388651,
        "details": [
            {
                "function": {
                    "value": 0.028388651,
                    "description": "weight(text:the in 134) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 1018,
                    "freq, occurrences of term within document": 11.0
                }
            },
            {
                "function": {
                    "value": 6.8298907,
                    "description": "weight(text:crystallin in 134) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 20,
                    "freq, occurrences of term within document": 4.0
                }
            },
            {
                "function": {
                    "value": 4.6366253,
                    "description": "weight(text:len in 134) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 41,
                    "freq, occurrences of term within document": 2.0
                }
            },
            {
                "function": {
                    "value": 0.06643554,
                    "description": "weight(text:in in 134) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 986,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```


Hunspell stemmer hits:
'1752. separation of <em>the</em> soluble proteins of bovine <em>lenses</em> on polyacrylamide gels <em>the</em> soluble proteins',
     '<em>the</em> presence of ethylenediaminetetra- acetate <em>in</em> <em>the</em> buffer was found to be essential for achieving a',
     'good separation of <em>the</em> <em>lens</em> homogenate into four fractions - a, b, c and d.',
     'soluble crystallin fractions of <em>the</em> <em>lens</em>.',
     'distribution of these four protein fractions <em>in</em> <em>the</em> nuclear and cortical parts of calf and cow <em>lenses</em>'

Score: 5.2
Position: 34
```
{
    "score": 5.2029753,
    "text": {
        "total_value": 0.028472036,
        "details": [
            {
                "function": {
                    "value": 0.028472036,
                    "description": "weight(text:the in 133) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 1018,
                    "freq, occurrences of term within document": 11.0
                }
            },
            {
                "function": {
                    "value": 5.1072903,
                    "description": "weight(Synonym(text:l text:lens) in 133) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 75,
                    "freq, occurrences of term within document": 8.0
                }
            },
            {
                "function": {
                    "value": 0.06721313,
                    "description": "weight(text:in in 133) [PerFieldSimilarity], result of:",
                    "n, number of documents containing term": 986,
                    "freq, occurrences of term within document": 2.0
                }
            }
        ]
    }
}
```
Analysis:

Stemming:
```
{
  "tokens" : [
    {
      "token" : "the",
      "start_offset" : 0,
      "end_offset" : 3,
      "type" : "<ALPHANUM>",
      "position" : 0
    },
    {
      "token" : "crystallin",
      "start_offset" : 4,
      "end_offset" : 15,
      "type" : "<ALPHANUM>",
      "position" : 1
    },
    {
      "token" : "len",
      "start_offset" : 16,
      "end_offset" : 20,
      "type" : "<ALPHANUM>",
      "position" : 2
    },
    {
      "token" : "in",
      "start_offset" : 21,
      "end_offset" : 23,
      "type" : "<ALPHANUM>",
      "position" : 3
    },
    {
      "token" : "vertebr",
      "start_offset" : 24,
      "end_offset" : 35,
      "type" : "<ALPHANUM>",
      "position" : 4
    },
    {
      "token" : "includ",
      "start_offset" : 37,
      "end_offset" : 46,
      "type" : "<ALPHANUM>",
      "position" : 5
    },
    {
      "token" : "human",
      "start_offset" : 47,
      "end_offset" : 53,
      "type" : "<ALPHANUM>",
      "position" : 6
    }
  ]
}
```
Hunspell:
```
{
  "tokens" : [
    {
      "token" : "the",
      "start_offset" : 0,
      "end_offset" : 3,
      "type" : "<ALPHANUM>",
      "position" : 0
    },
    {
      "token" : "crystalline",
      "start_offset" : 4,
      "end_offset" : 15,
      "type" : "<ALPHANUM>",
      "position" : 1
    },
    {
      "token" : "lens",
      "start_offset" : 16,
      "end_offset" : 20,
      "type" : "<ALPHANUM>",
      "position" : 2
    },
    {
      "token" : "l",
      "start_offset" : 16,
      "end_offset" : 20,
      "type" : "<ALPHANUM>",
      "position" : 2
    },
    {
      "token" : "in",
      "start_offset" : 21,
      "end_offset" : 23,
      "type" : "<ALPHANUM>",
      "position" : 3
    },
    {
      "token" : "vertebrate",
      "start_offset" : 24,
      "end_offset" : 35,
      "type" : "<ALPHANUM>",
      "position" : 4
    },
    {
      "token" : "include",
      "start_offset" : 37,
      "end_offset" : 46,
      "type" : "<ALPHANUM>",
      "position" : 5
    },
    {
      "token" : "human",
      "start_offset" : 47,
      "end_offset" : 53,
      "type" : "<ALPHANUM>",
      "position" : 6
    }
  ]
}
```

#### 4. Conclusion
